<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tłumaczenia Społecznościowe - Panel Moderacji</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --accent-color: #4cc9f0;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #f72585;
            --creator-color: #ffd700;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fb;
            color: var(--dark-color);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Styl ekranu logowania */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        }

        .login-container {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 2.5rem;
            width: 100%;
            max-width: 450px;
            box-shadow: var(--box-shadow);
        }

        .login-container h1 {
            color: var(--secondary-color);
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .login-container .logo {
            text-align: center;
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .login-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #eee;
        }

        .login-tab {
            flex: 1;
            text-align: center;
            padding: 0.8rem;
            cursor: pointer;
            font-weight: 600;
            color: #777;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .login-tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .login-form {
            display: none;
        }

        .login-form.active {
            display: block;
        }

        .role-select {
            margin-bottom: 1.2rem;
        }

        .role-select label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .role-options {
            display: flex;
            gap: 1rem;
        }

        .role-option {
            flex: 1;
            text-align: center;
            padding: 0.8rem;
            border: 2px solid #ddd;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.3s;
        }

        .role-option.active {
            border-color: var(--primary-color);
            background-color: rgba(67, 97, 238, 0.1);
        }

        .admin-note {
            background-color: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: var(--border-radius);
            padding: 0.8rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #856404;
        }

        /* Styl głównej aplikacji */
        .app-screen {
            display: none;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: white;
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            box-shadow: var(--box-shadow);
        }

        .user-details {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .user-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .user-role {
            background-color: #e9ecef;
            color: #666;
            padding: 0.2rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .creator-role {
            background-color: var(--creator-color);
            color: var(--dark-color);
            font-weight: bold;
        }

        .logout-btn {
            background-color: #f8f9fa;
            color: var(--danger-color);
            border: 1px solid #ddd;
            padding: 0.5rem 1.2rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background-color: var(--danger-color);
            color: white;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem 0;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            box-shadow: var(--box-shadow);
            text-align: center;
        }

        header h1 {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 2rem;
        }

        .left-column {
            flex: 1;
            min-width: 300px;
        }

        .right-column {
            flex: 2;
            min-width: 300px;
        }

        .card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--box-shadow);
        }

        .card h2 {
            color: var(--secondary-color);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        input, textarea, select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s, transform 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-warning {
            background-color: var(--warning-color);
        }

        .btn-danger {
            background-color: var(--danger-color);
        }

        .language-selectors {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .language-selector {
            flex: 1;
        }

        .language-error {
            color: var(--danger-color);
            font-size: 0.9rem;
            margin-top: 0.5rem;
            display: none;
        }

        .words-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .word-item {
            background-color: #f9f9f9;
            border-radius: var(--border-radius);
            padding: 1.2rem;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary-color);
            transition: transform 0.2s;
            cursor: pointer;
        }

        .word-item:hover {
            transform: translateX(5px);
            background-color: #f0f4ff;
        }

        .word-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
        }

        .word-text {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--secondary-color);
        }

        .word-lang {
            background-color: var(--accent-color);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .translations-list {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }

        .translation-item {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 0.8rem;
            border: 1px solid #eee;
        }

        .translation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .translation-text {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .translation-lang {
            background-color: #e9ecef;
            color: var(--dark-color);
            padding: 0.2rem 0.6rem;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .translation-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 0.8rem;
        }

        .vote-count {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--secondary-color);
            min-width: 30px;
            text-align: center;
        }

        .vote-btn {
            background: none;
            border: none;
            color: #aaa;
            cursor: pointer;
            font-size: 1.2rem;
            transition: color 0.3s;
        }

        .vote-btn:hover {
            color: var(--primary-color);
        }

        .vote-btn.active {
            color: var(--primary-color);
        }

        .creator-vote {
            color: var(--creator-color);
            font-weight: bold;
            margin-left: 0.5rem;
        }

        .moderation-panel {
            background-color: #fff8e1;
            border-left: 4px solid var(--warning-color);
        }

        .moderation-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .pending-item {
            background-color: #fff3cd;
            border-left: 4px solid var(--warning-color);
        }

        .creator-badge {
            background-color: var(--creator-color);
            color: var(--dark-color);
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            display: inline-block;
            margin-left: 0.5rem;
        }

        .additional-explanation {
            margin-top: 0.8rem;
            padding: 0.8rem;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            color: #666;
            border-left: 3px solid #ccc;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 1.5rem;
        }

        .tab {
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            color: #777;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #888;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ddd;
        }

        footer {
            text-align: center;
            margin-top: 3rem;
            padding: 1.5rem;
            color: #777;
            font-size: 0.9rem;
            border-top: 1px solid #eee;
        }

        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .status-accepted {
            background-color: #d4edda;
            color: #155724;
        }

        .status-rejected {
            background-color: #f8d7da;
            color: #721c24;
        }

        .admin-only {
            display: none;
        }

        .admin-only.visible {
            display: block;
        }

        .message {
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            display: none;
        }

        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .language-selectors {
                flex-direction: column;
            }
            
            .user-info {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <!-- EKRAN LOGOWANIA -->
    <div id="login-screen" class="login-screen">
        <div class="login-container">
            <div class="logo">
                <i class="fas fa-language"></i>
            </div>
            <h1>Tłumaczenia Społecznościowe</h1>
            
            <div class="login-tabs">
                <div class="login-tab active" data-tab="login">Zaloguj się</div>
                <div class="login-tab" data-tab="register">Zarejestruj się</div>
            </div>
            
            <!-- Formularz logowania -->
            <div id="login-form" class="login-form active">
                <div class="form-group">
                    <label for="login-username">Nazwa użytkownika:</label>
                    <input type="text" id="login-username" placeholder="Wpisz swoją nazwę użytkownika" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Hasło:</label>
                    <input type="password" id="login-password" placeholder="Wpisz swoje hasło" required>
                </div>
                <div id="login-message" class="message"></div>
                <button id="login-btn" class="btn" style="width: 100%;">
                    <i class="fas fa-sign-in-alt"></i> Zaloguj się
                </button>
            </div>
            
            <!-- Formularz rejestracji -->
            <div id="register-form" class="login-form">
                <div class="form-group">
                    <label for="register-username">Nazwa użytkownika:</label>
                    <input type="text" id="register-username" placeholder="Wybierz nazwę użytkownika" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Hasło:</label>
                    <input type="password" id="register-password" placeholder="Wybierz bezpieczne hasło" required>
                </div>
                <div class="form-group">
                    <label for="register-password-confirm">Potwierdź hasło:</label>
                    <input type="password" id="register-password-confirm" placeholder="Powtórz hasło" required>
                </div>
                
                <div class="role-select">
                    <label>Typ konta:</label>
                    <div class="role-options">
                        <div class="role-option active" data-role="user">
                            <i class="fas fa-user"></i><br>
                            Zwykły użytkownik
                        </div>
                        <div class="role-option" data-role="creator">
                            <i class="fas fa-crown"></i><br>
                            Twórca/Moderator
                        </div>
                    </div>
                </div>
                
                <div id="creator-note" class="admin-note" style="display: none;">
                    <strong><i class="fas fa-lock"></i> Dostęp tylko dla twórcy</strong><br>
                    Aby zarejestrować się jako twórca, musisz znać kod dostępu: <strong>ADMIN2024</strong>
                </div>
                
                <div class="form-group">
                    <label for="creator-code" id="creator-code-label" style="display: none;">Kod dostępu twórcy:</label>
                    <input type="password" id="creator-code" placeholder="Wpisz kod dostępu" style="display: none;">
                </div>
                
                <div id="register-message" class="message"></div>
                <button id="register-btn" class="btn" style="width: 100%;">
                    <i class="fas fa-user-plus"></i> Zarejestruj się
                </button>
            </div>
        </div>
    </div>
    
    <!-- GŁÓWNA APLIKACJA (widoczna po zalogowaniu) -->
    <div id="app-screen" class="app-screen">
        <div class="container">
            <!-- Panel użytkownika -->
            <div class="user-info">
                <div class="user-details">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <div>
                        <div class="user-name" id="user-name">Użytkownik</div>
                        <div class="user-role" id="user-role">Zwykły użytkownik</div>
                    </div>
                </div>
                <button id="logout-btn" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i> Wyloguj się
                </button>
            </div>
            
            <header>
                <h1><i class="fas fa-language"></i> Tłumaczenia Społecznościowe</h1>
                <p>Wspólnie tłumaczmy słowa i zwroty między językami</p>
            </header>

            <div class="language-selectors">
                <div class="language-selector">
                    <label for="source-lang">Tłumacz z języka:</label>
                    <select id="source-lang">
                        <option value="en">Angielski (EN)</option>
                        <option value="pl">Polski (PL)</option>
                        <option value="de">Niemiecki (DE)</option>
                        <option value="fr">Francuski (FR)</option>
                        <option value="es">Hiszpański (ES)</option>
                        <option value="it">Włoski (IT)</option>
                    </select>
                </div>
                <div class="language-selector">
                    <label for="target-lang">Tłumacz na język:</label>
                    <select id="target-lang">
                        <option value="pl">Polski (PL)</option>
                        <option value="en">Angielski (EN)</option>
                        <option value="de">Niemiecki (DE)</option>
                        <option value="fr">Francuski (FR)</option>
                        <option value="es">Hiszpański (ES)</option>
                        <option value="it">Włoski (IT)</option>
                    </select>
                </div>
            </div>
            <div id="language-error" class="language-error">
                <i class="fas fa-exclamation-triangle"></i> Nie można tłumaczyć na ten sam język!
            </div>

            <div class="main-content">
                <div class="left-column">
                    <div class="card">
                        <h2><i class="fas fa-plus-circle"></i> Dodaj nowe słowo/zwrot</h2>
                        <form id="add-word-form">
                            <div class="form-group">
                                <label for="word-text">Słowo lub zwrot:</label>
                                <input type="text" id="word-text" placeholder="np. vessel, kissable, larger than life" required>
                            </div>
                            <div class="form-group">
                                <label for="word-explanation">Wyjaśnienie/kontekst (opcjonalnie):</label>
                                <textarea id="word-explanation" placeholder="Możesz dodać wyjaśnienie lub kontekst użycia..."></textarea>
                            </div>
                            <button type="submit" class="btn"><i class="fas fa-paper-plane"></i> Prześlij do moderacji</button>
                        </form>
                    </div>

                    <!-- PANEL MODERACJI - WIDOCZNY TYLKO DLA TWÓRCY -->
                    <div id="moderation-panel" class="card moderation-panel admin-only">
                        <h2><i class="fas fa-user-shield"></i> Panel moderacji (Twórca)</h2>
                        <div class="tabs">
                            <div class="tab active" data-tab="pending">Oczekujące</div>
                            <div class="tab" data-tab="rejected">Odrzucone</div>
                            <div class="tab" data-tab="all">Wszystkie</div>
                        </div>
                        
                        <div class="tab-content active" id="pending-tab">
                            <div id="pending-words-list" class="words-list"></div>
                        </div>
                        
                        <div class="tab-content" id="rejected-tab">
                            <div id="rejected-words-list" class="words-list"></div>
                        </div>
                        
                        <div class="tab-content" id="all-tab">
                            <div id="all-words-list" class="words-list"></div>
                        </div>
                    </div>
                </div>

                <div class="right-column">
                    <div class="card">
                        <h2><i class="fas fa-list"></i> Zaakceptowane słowa/zwroty</h2>
                        <div id="accepted-words-list" class="words-list"></div>
                    </div>

                    <div class="card" id="word-details" style="display: none;">
                        <h2><i class="fas fa-info-circle"></i> Szczegóły słowa/zwrotu</h2>
                        <div id="selected-word-details"></div>
                        
                        <div class="form-group" style="margin-top: 2rem;">
                            <h3><i class="fas fa-comment-alt"></i> Zaproponuj tłumaczenie</h3>
                            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                                <input type="text" id="translation-text" placeholder="Twoje tłumaczenie..." style="flex: 1;">
                                <button id="add-translation-btn" class="btn"><i class="fas fa-plus"></i> Dodaj</button>
                            </div>
                            <div class="form-group" style="margin-top: 1rem;">
                                <label for="additional-explanation">Dodatkowe wyjaśnienie (opcjonalnie):</label>
                                <textarea id="additional-explanation" placeholder="Np. to słowo oznacza ucieleśnienie się czyjejś duszy w czyimś ciele..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <footer>
                <p>Strona do crowdsourcingu tłumaczeń &copy; 2024 | Głos twórcy strony jest oznaczony <span class="creator-badge">Twórca</span></p>
                <p style="margin-top: 0.5rem; font-size: 0.8rem;">Zalogowany jako: <span id="footer-user">-</span></p>
            </footer>
        </div>
    </div>

    <script>
        // ===================== SYSTEM KONT UŻYTKOWNIKÓW =====================
        
        // Konto twórcy/moderatora (domyślne)
        const CREATOR_ACCESS_CODE = "ADMIN_2026";
        
        // Pobierz użytkowników z localStorage lub utwórz domyślnych
        let users = JSON.parse(localStorage.getItem('translationUsers')) || [
            {
                username: "admin",
                password: "admin123",
                role: "creator",
                createdAt: new Date().toISOString()
            },
            {
                username: "uzytkownik",
                password: "haslo123",
                role: "user",
                createdAt: new Date().toISOString()
            }
        ];
        
        // Aktualnie zalogowany użytkownik
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        
        // Dane aplikacji
        let words = JSON.parse(localStorage.getItem('translationWords')) || [
            {
                id: 1,
                text: "vessel",
                sourceLang: "en",
                targetLang: "pl",
                explanation: "",
                status: "accepted",
                createdAt: "2024-01-15",
                createdBy: "uzytkownik",
                translations: [
                    {
                        id: 1,
                        text: "wesel",
                        explanation: "oznacza ucieleśnienie się czyjejś duszy w czyimś ciele nie zastępując jego duszy a współżyjąc z nią",
                        votes: 5,
                        creatorVote: true,
                        createdBy: "admin"
                    },
                    {
                        id: 2,
                        text: "naczynie",
                        explanation: "",
                        votes: 2,
                        creatorVote: false,
                        createdBy: "uzytkownik"
                    }
                ]
            },
            {
                id: 2,
                text: "kissable",
                sourceLang: "en",
                targetLang: "pl",
                explanation: "",
                status: "accepted",
                createdAt: "2024-01-16",
                createdBy: "uzytkownik",
                translations: [
                    {
                        id: 3,
                        text: "pocałunkowy",
                        explanation: "",
                        votes: 8,
                        creatorVote: true,
                        createdBy: "admin"
                    },
                    {
                        id: 4,
                        text: "nadający się do pocałowania",
                        explanation: "",
                        votes: 3,
                        creatorVote: false,
                        createdBy: "nowy_uzytkownik"
                    }
                ]
            },
            {
                id: 3,
                text: "larger than life",
                sourceLang: "en",
                targetLang: "pl",
                explanation: "wyrażenie opisujące kogoś lub coś wyjątkowego, imponującego",
                status: "accepted",
                createdAt: "2024-01-17",
                createdBy: "uzytkownik",
                translations: [
                    {
                        id: 5,
                        text: "przerastający oczekiwania",
                        explanation: "",
                        votes: 7,
                        creatorVote: true,
                        createdBy: "admin"
                    },
                    {
                        id: 6,
                        text: "większy niż życie",
                        explanation: "dosłowne tłumaczenie, również używane",
                        votes: 4,
                        creatorVote: false,
                        createdBy: "tłumacz"
                    }
                ]
            },
            {
                id: 4,
                text: "serendipity",
                sourceLang: "en",
                targetLang: "pl",
                explanation: "szczęśliwy traf, przypadkowe odkrycie czegoś wartościowego",
                status: "pending",
                createdAt: "2024-01-18",
                createdBy: "word_explorer",
                translations: []
            }
        ];
        
        let userVotes = JSON.parse(localStorage.getItem('userVotes')) || {};
        let selectedWordId = null;
        
        // ===================== FUNKCJE SYSTEMU LOGOWANIA =====================
        
        // Sprawdź czy użytkownik jest zalogowany przy ładowaniu strony
        function checkLoginStatus() {
            if (currentUser) {
                showAppScreen();
            } else {
                showLoginScreen();
            }
        }
        
        // Pokaż ekran logowania
        function showLoginScreen() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('app-screen').style.display = 'none';
            
            // Reset formularzy
            document.getElementById('login-username').value = '';
            document.getElementById('login-password').value = '';
            document.getElementById('register-username').value = '';
            document.getElementById('register-password').value = '';
            document.getElementById('register-password-confirm').value = '';
            document.getElementById('creator-code').value = '';
            
            // Ukryj komunikaty
            document.getElementById('login-message').className = 'message';
            document.getElementById('register-message').className = 'message';
        }
        
        // Pokaż główną aplikację
        function showAppScreen() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-screen').style.display = 'block';
            
            // Ustaw informacje o użytkowniku
            document.getElementById('user-name').textContent = currentUser.username;
            document.getElementById('footer-user').textContent = currentUser.username;
            
            // Ustaw awatar (pierwsza litera nazwy)
            document.getElementById('user-avatar').textContent = currentUser.username.charAt(0).toUpperCase();
            
            // Ustaw rolę użytkownika
            const userRoleElement = document.getElementById('user-role');
            if (currentUser.role === 'creator') {
                userRoleElement.textContent = 'Twórca/Moderator';
                userRoleElement.classList.add('creator-role');
                
                // Pokaż panel moderacji tylko dla twórcy
                document.getElementById('moderation-panel').classList.add('visible');
            } else {
                userRoleElement.textContent = 'Zwykły użytkownik';
                userRoleElement.classList.remove('creator-role');
                
                // Ukryj panel moderacji
                document.getElementById('moderation-panel').classList.remove('visible');
            }
            
            // Załaduj dane aplikacji
            loadAcceptedWords();
            loadPendingWords();
            loadRejectedWords();
            loadAllWords();
            
            // Sprawdź czy języki są takie same
            checkLanguages();
        }
        
        // Logowanie użytkownika
        function loginUser(username, password) {
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showAppScreen();
                return true;
            } else {
                showMessage('login-message', 'Nieprawidłowa nazwa użytkownika lub hasło!', 'error');
                return false;
            }
        }
        
        // Rejestracja nowego użytkownika
        function registerUser(username, password, role, creatorCode = '') {
            // Walidacja
            if (users.find(u => u.username === username)) {
                showMessage('register-message', 'Nazwa użytkownika jest już zajęta!', 'error');
                return false;
            }
            
            if (password.length < 6) {
                showMessage('register-message', 'Hasło musi mieć co najmniej 6 znaków!', 'error');
                return false;
            }
            
            // Sprawdź czy próbuje zarejestrować się jako twórca
            if (role === 'creator') {
                if (creatorCode !== CREATOR_ACCESS_CODE) {
                    showMessage('register-message', 'Nieprawidłowy kod dostępu dla twórcy!', 'error');
                    return false;
                }
            }
            
            // Utwórz nowego użytkownika
            const newUser = {
                username: username,
                password: password,
                role: role,
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            localStorage.setItem('translationUsers', JSON.stringify(users));
            
            // Zaloguj nowego użytkownika
            currentUser = newUser;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            showAppScreen();
            return true;
        }
        
        // Wylogowanie użytkownika
        function logoutUser() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showLoginScreen();
        }
        
        // Wyświetlanie komunikatów
        function showMessage(elementId, text, type) {
            const element = document.getElementById(elementId);
            element.textContent = text;
            element.className = `message ${type}`;
            
            // Ukryj komunikat po 5 sekundach
            if (type === 'success') {
                setTimeout(() => {
                    element.className = 'message';
                }, 5000);
            }
        }
        
        // ===================== FUNKCJE APLIKACJI =====================
        
        // Sprawdź czy język źródłowy i docelowy są takie same
        function checkLanguages() {
            const sourceLang = document.getElementById('source-lang').value;
            const targetLang = document.getElementById('target-lang').value;
            const errorElement = document.getElementById('language-error');
            
            if (sourceLang === targetLang) {
                errorElement.style.display = 'block';
                document.getElementById('add-word-form').querySelector('button').disabled = true;
                return false;
            } else {
                errorElement.style.display = 'none';
                document.getElementById('add-word-form').querySelector('button').disabled = false;
                return true;
            }
        }
        
        // Ładowanie zaakceptowanych słów
        function loadAcceptedWords() {
            const sourceLang = document.getElementById('source-lang').value;
            const targetLang = document.getElementById('target-lang').value;
            
            const acceptedWords = words.filter(word => 
                word.status === 'accepted' && 
                word.sourceLang === sourceLang && 
                word.targetLang === targetLang
            );
            
            const container = document.getElementById('accepted-words-list');
            
            if (acceptedWords.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>Brak zaakceptowanych słów</h3>
                        <p>Dodaj nowe słowo lub zmień filtr językowy</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            acceptedWords.forEach(word => {
                const wordElement = document.createElement('div');
                wordElement.className = 'word-item';
                wordElement.dataset.id = word.id;
                
                let translationsHtml = '';
                if (word.translations && word.translations.length > 0) {
                    // Sortuj tłumaczenia według liczby głosów (malejąco)
                    const sortedTranslations = [...word.translations].sort((a, b) => b.votes - a.votes);
                    
                    translationsHtml = '<div class="translations-list">';
                    sortedTranslations.forEach(trans => {
                        const userHasVoted = userVotes[trans.id] || false;
                        const creatorVoteBadge = trans.creatorVote ? ' <span class="creator-badge">Twórca</span>' : '';
                        
                        translationsHtml += `
                            <div class="translation-item">
                                <div class="translation-header">
                                    <div class="translation-text">${trans.text}</div>
                                    <div class="translation-lang">${getLanguageName(word.targetLang)}</div>
                                </div>
                                ${trans.explanation ? `<div class="additional-explanation">${trans.explanation}</div>` : ''}
                                <div class="translation-actions">
                                    <button class="vote-btn ${userHasVoted ? 'active' : ''}" data-translation-id="${trans.id}">
                                        <i class="fas fa-thumbs-up"></i>
                                    </button>
                                    <div class="vote-count">${trans.votes}</div>
                                    ${creatorVoteBadge}
                                    <div style="margin-left: auto; font-size: 0.8rem; color: #777;">
                                        dodane przez: ${trans.createdBy}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    translationsHtml += '</div>';
                }
                
                wordElement.innerHTML = `
                    <div class="word-header">
                        <div class="word-text">${word.text}</div>
                        <div class="word-lang">${getLanguageName(word.sourceLang)} → ${getLanguageName(word.targetLang)}</div>
                    </div>
                    ${word.explanation ? `<p><i>${word.explanation}</i></p>` : ''}
                    <div style="font-size: 0.85rem; color: #666; margin-top: 0.5rem;">
                        Dodane przez: ${word.createdBy} • ${word.createdAt}
                    </div>
                    ${translationsHtml}
                `;
                
                // Dodaj obsługę kliknięcia na słowo
                wordElement.addEventListener('click', function(e) {
                    if (!e.target.closest('.vote-btn') && !e.target.closest('.translation-item')) {
                        selectWord(word.id);
                    }
                });
                
                // Dodaj obsługę głosowania
                wordElement.querySelectorAll('.vote-btn').forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const translationId = parseInt(this.getAttribute('data-translation-id'));
                        voteForTranslation(translationId);
                    });
                });
                
                container.appendChild(wordElement);
            });
        }
        
        // Ładowanie słów oczekujących na moderację
        function loadPendingWords() {
            const pendingWords = words.filter(word => word.status === 'pending');
            const container = document.getElementById('pending-words-list');
            
            if (pendingWords.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <h3>Brak słów oczekujących</h3>
                        <p>Wszystkie słowa zostały zweryfikowane</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            pendingWords.forEach(word => {
                const wordElement = document.createElement('div');
                wordElement.className = 'word-item pending-item';
                wordElement.innerHTML = `
                    <div class="word-header">
                        <div class="word-text">${word.text}</div>
                        <div class="word-lang">${getLanguageName(word.sourceLang)} → ${getLanguageName(word.targetLang)}</div>
                    </div>
                    ${word.explanation ? `<p><i>${word.explanation}</i></p>` : ''}
                    <div style="font-size: 0.85rem; color: #666; margin-top: 0.5rem;">
                        Dodane przez: ${word.createdBy} • ${word.createdAt}
                    </div>
                    <div class="moderation-actions">
                        <button class="btn btn-success btn-accept" data-id="${word.id}">
                            <i class="fas fa-check"></i> Zaakceptuj
                        </button>
                        <button class="btn btn-danger btn-reject" data-id="${word.id}">
                            <i class="fas fa-times"></i> Odrzuć
                        </button>
                        <button class="btn btn-danger btn-delete" data-id="${word.id}" style="margin-left: auto;">
                            <i class="fas fa-trash"></i> Usuń
                        </button>
                    </div>
                `;
                
                // Dodaj obsługę przycisków moderacji
                wordElement.querySelector('.btn-accept').addEventListener('click', function() {
                    acceptWord(word.id);
                });
                
                wordElement.querySelector('.btn-reject').addEventListener('click', function() {
                    rejectWord(word.id);
                });
                
                wordElement.querySelector('.btn-delete').addEventListener('click', function() {
                    deleteWord(word.id);
                });
                
                container.appendChild(wordElement);
            });
        }
        
        // Ładowanie odrzuconych słów
        function loadRejectedWords() {
            const rejectedWords = words.filter(word => word.status === 'rejected');
            const container = document.getElementById('rejected-words-list');
            
            if (rejectedWords.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-ban"></i>
                        <h3>Brak odrzuconych słów</h3>
                        <p>Nie odrzucono jeszcze żadnych słów</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            rejectedWords.forEach(word => {
                const wordElement = document.createElement('div');
                wordElement.className = 'word-item';
                wordElement.style.borderLeftColor = 'var(--danger-color)';
                wordElement.innerHTML = `
                    <div class="word-header">
                        <div class="word-text">${word.text}</div>
                        <div>
                            <span class="status-badge status-rejected">Odrzucone</span>
                            <div class="word-lang">${getLanguageName(word.sourceLang)} → ${getLanguageName(word.targetLang)}</div>
                        </div>
                    </div>
                    ${word.explanation ? `<p><i>${word.explanation}</i></p>` : ''}
                    <div style="font-size: 0.85rem; color: #666; margin-top: 0.5rem;">
                        Dodane przez: ${word.createdBy} • ${word.createdAt} • Odrzucone przez moderatora
                    </div>
                    <div class="moderation-actions">
                        <button class="btn btn-success btn-restore" data-id="${word.id}">
                            <i class="fas fa-undo"></i> Przywróć do oczekujących
                        </button>
                        <button class="btn btn-danger btn-delete" data-id="${word.id}" style="margin-left: auto;">
                            <i class="fas fa-trash"></i> Usuń
                        </button>
                    </div>
                `;
                
                // Dodaj obsługę przycisków
                wordElement.querySelector('.btn-restore').addEventListener('click', function() {
                    restoreWord(word.id);
                });
                
                wordElement.querySelector('.btn-delete').addEventListener('click', function() {
                    deleteWord(word.id);
                });
                
                container.appendChild(wordElement);
            });
        }
        
        // Ładowanie wszystkich słów (dla panelu twórcy)
        function loadAllWords() {
            const container = document.getElementById('all-words-list');
            const allWords = [...words].sort((a, b) => {
                // Najpierw status: pending, rejected, accepted
                const statusOrder = {pending: 0, rejected: 1, accepted: 2};
                if (statusOrder[a.status] !== statusOrder[b.status]) {
                    return statusOrder[a.status] - statusOrder[b.status];
                }
                return b.id - a.id; // Nowe na górze
            });
            
            if (allWords.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>Brak słów w systemie</h3>
                        <p>Dodaj pierwsze słowo do tłumaczenia</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            allWords.forEach(word => {
                let statusClass, statusText;
                switch(word.status) {
                    case 'pending': 
                        statusClass = 'status-pending'; 
                        statusText = 'Oczekujące'; 
                        break;
                    case 'accepted': 
                        statusClass = 'status-accepted'; 
                        statusText = 'Zaakceptowane'; 
                        break;
                    case 'rejected': 
                        statusClass = 'status-rejected'; 
                        statusText = 'Odrzucone'; 
                        break;
                }
                
                const wordElement = document.createElement('div');
                wordElement.className = 'word-item';
                wordElement.innerHTML = `
                    <div class="word-header">
                        <div class="word-text">${word.text}</div>
                        <div>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                            <div class="word-lang">${getLanguageName(word.sourceLang)} → ${getLanguageName(word.targetLang)}</div>
                        </div>
                    </div>
                    ${word.explanation ? `<p><i>${word.explanation}</i></p>` : ''}
                    <div style="font-size: 0.85rem; color: #666; margin-top: 0.5rem;">
                        Dodane przez: ${word.createdBy} • ${word.createdAt} • ID: ${word.id}
                    </div>
                    <div style="margin-top: 0.8rem;">
                        <strong>Tłumaczenia (${word.translations.length}):</strong>
                        ${word.translations.length > 0 ? 
                            '<ul style="margin-top: 0.5rem; padding-left: 1.5rem;">' + 
                            word.translations.map(t => `<li>${t.text} (głosy: ${t.votes})</li>`).join('') + 
                            '</ul>' : 
                            '<p style="font-style: italic; color: #888;">Brak tłumaczeń</p>'
                        }
                    </div>
                    ${currentUser.role === 'creator' ? `
                    <div class="moderation-actions">
                        ${word.status !== 'accepted' ? `<button class="btn btn-success btn-accept" data-id="${word.id}" style="font-size: 0.8rem; padding: 0.4rem 0.8rem;">
                            <i class="fas fa-check"></i> Zaakceptuj
                        </button>` : ''}
                        ${word.status !== 'rejected' ? `<button class="btn btn-warning btn-reject" data-id="${word.id}" style="font-size: 0.8rem; padding: 0.4rem 0.8rem;">
                            <i class="fas fa-times"></i> Odrzuć
                        </button>` : ''}
                        ${word.status === 'rejected' ? `<button class="btn btn-success btn-restore" data-id="${word.id}" style="font-size: 0.8rem; padding: 0.4rem 0.8rem;">
                            <i class="fas fa-undo"></i> Przywróć
                        </button>` : ''}
                        <button class="btn btn-danger btn-delete" data-id="${word.id}" style="font-size: 0.8rem; padding: 0.4rem 0.8rem; margin-left: auto;">
                            <i class="fas fa-trash"></i> Usuń
                        </button>
                    </div>
                    ` : ''}
                `;
                
                // Dodaj obsługę przycisków (tylko dla twórcy)
                if (currentUser.role === 'creator') {
                    const acceptBtn = wordElement.querySelector('.btn-accept');
                    const rejectBtn = wordElement.querySelector('.btn-reject');
                    const restoreBtn = wordElement.querySelector('.btn-restore');
                    const deleteBtn = wordElement.querySelector('.btn-delete');
                    
                    if (acceptBtn) acceptBtn.addEventListener('click', function() { acceptWord(word.id); });
                    if (rejectBtn) rejectBtn.addEventListener('click', function() { rejectWord(word.id); });
                    if (restoreBtn) restoreBtn.addEventListener('click', function() { restoreWord(word.id); });
                    if (deleteBtn) deleteBtn.addEventListener('click', function() { deleteWord(word.id); });
                }
                
                container.appendChild(wordElement);
            });
        }
        
        // Wybór słowa do wyświetlenia szczegółów
        function selectWord(wordId) {
            selectedWordId = wordId;
            const word = words.find(w => w.id === wordId);
            
            if (!word) return;
            
            document.getElementById('word-details').style.display = 'block';
            
            let translationsHtml = '';
            if (word.translations && word.translations.length > 0) {
                // Sortuj tłumaczenia według liczby głosów (malejąco)
                const sortedTranslations = [...word.translations].sort((a, b) => b.votes - a.votes);
                
                translationsHtml = '<div class="translations-list">';
                sortedTranslations.forEach(trans => {
                    const userHasVoted = userVotes[trans.id] || false;
                    const creatorVoteBadge = trans.creatorVote ? ' <span class="creator-badge">Twórca</span>' : '';
                    
                    translationsHtml += `
                        <div class="translation-item">
                            <div class="translation-header">
                                <div class="translation-text">${trans.text}</div>
                                <div class="translation-lang">${getLanguageName(word.targetLang)}</div>
                            </div>
                            ${trans.explanation ? `<div class="additional-explanation">${trans.explanation}</div>` : ''}
                            <div class="translation-actions">
                                <button class="vote-btn ${userHasVoted ? 'active' : ''}" data-translation-id="${trans.id}">
                                    <i class="fas fa-thumbs-up"></i>
                                </button>
                                <div class="vote-count">${trans.votes}</div>
                                ${creatorVoteBadge}
                                <div style="margin-left: auto; font-size: 0.8rem; color: #777;">
                                    dodane przez: ${trans.createdBy}
                                </div>
                            </div>
                        </div>
                    `;
                });
                translationsHtml += '</div>';
            } else {
                translationsHtml = '<p style="font-style: italic; color: #888; text-align: center; padding: 2rem;">Brak tłumaczeń. Bądź pierwszy który zaproponuje tłumaczenie!</p>';
            }
            
            document.getElementById('selected-word-details').innerHTML = `
                <div class="word-header">
                    <div class="word-text">${word.text}</div>
                    <div class="word-lang">${getLanguageName(word.sourceLang)} → ${getLanguageName(word.targetLang)}</div>
                </div>
                ${word.explanation ? `<p><i>${word.explanation}</i></p>` : ''}
                <div style="font-size: 0.85rem; color: #666; margin-top: 0.5rem;">
                    Dodane przez: ${word.createdBy} • ${word.createdAt}
                </div>
                <h3 style="margin-top: 1.5rem;">Proponowane tłumaczenia:</h3>
                ${translationsHtml}
            `;
            
            // Dodaj obsługę głosowania w szczegółach
            document.querySelectorAll('#selected-word-details .vote-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const translationId = parseInt(this.getAttribute('data-translation-id'));
                    voteForTranslation(translationId);
                });
            });
            
            // Przewiń do sekcji szczegółów
            document.getElementById('word-details').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Dodawanie nowego słowa
        function addNewWord() {
            // Sprawdź czy języki są różne
            if (!checkLanguages()) {
                alert('Nie można tłumaczyć na ten sam język! Zmień język źródłowy lub docelowy.');
                return;
            }
            
            const wordText = document.getElementById('word-text').value.trim();
            const explanation = document.getElementById('word-explanation').value.trim();
            const sourceLang = document.getElementById('source-lang').value;
            const targetLang = document.getElementById('target-lang').value;
            
            if (!wordText) {
                alert('Proszę wpisać słowo lub zwrot');
                return;
            }
            
            // Sprawdź czy słowo już istnieje
            const existingWord = words.find(w => 
                w.text.toLowerCase() === wordText.toLowerCase() && 
                w.sourceLang === sourceLang && 
                w.targetLang === targetLang
            );
            
            if (existingWord) {
                alert('To słowo już istnieje w bazie!');
                return;
            }
            
            // Utwórz nowe słowo
            const newWord = {
                id: words.length > 0 ? Math.max(...words.map(w => w.id)) + 1 : 1,
                text: wordText,
                sourceLang: sourceLang,
                targetLang: targetLang,
                explanation: explanation,
                status: "pending",
                createdAt: new Date().toISOString().split('T')[0],
                createdBy: currentUser.username,
                translations: []
            };
            
            words.push(newWord);
            saveData();
            
            // Wyczyść formularz
            document.getElementById('add-word-form').reset();
            
            // Odśwież listy
            if (currentUser.role === 'creator') {
                loadPendingWords();
                loadAllWords();
            }
            loadAcceptedWords();
            
            // Powiadomienie
            alert('Słowo zostało dodane i oczekuje na moderację!');
        }
        
        // Dodawanie tłumaczenia
        function addTranslation() {
            if (!selectedWordId) {
                alert('Proszę najpierw wybrać słowo/zwrot');
                return;
            }
            
            const translationText = document.getElementById('translation-text').value.trim();
            const additionalExplanation = document.getElementById('additional-explanation').value.trim();
            
            if (!translationText) {
                alert('Proszę wpisać tłumaczenie');
                return;
            }
            
            const word = words.find(w => w.id === selectedWordId);
            if (!word) {
                alert('Wybrane słowo nie istnieje');
                return;
            }
            
            // Sprawdź czy tłumaczenie już istnieje
            const existingTranslation = word.translations.find(t => 
                t.text.toLowerCase() === translationText.toLowerCase()
            );
            
            if (existingTranslation) {
                alert('To tłumaczenie już istnieje!');
                return;
            }
            
            // Utwórz nowe tłumaczenie
            const newTranslation = {
                id: word.translations.length > 0 ? Math.max(...word.translations.map(t => t.id)) + 1 : 1,
                text: translationText,
                explanation: additionalExplanation,
                votes: 0,
                creatorVote: currentUser.role === 'creator',
                createdBy: currentUser.username
            };
            
            word.translations.push(newTranslation);
            
            // Jeśli twórca dodał tłumaczenie, automatycznie zagłosuj
            if (currentUser.role === 'creator') {
                userVotes[newTranslation.id] = true;
                newTranslation.votes = 1;
            }
            
            // Zapisz dane
            saveData();
            
            // Wyczyść pola formularza
            document.getElementById('translation-text').value = '';
            document.getElementById('additional-explanation').value = '';
            
            // Odśwież wyświetlane dane
            loadAcceptedWords();
            if (currentUser.role === 'creator') {
                loadAllWords();
            }
            selectWord(selectedWordId);
            
            // Powiadomienie
            alert('Tłumaczenie zostało dodane!');
        }
        
        // Głosowanie na tłumaczenie
        function voteForTranslation(translationId) {
            // Znajdź tłumaczenie
            let translation = null;
            let wordForTranslation = null;
            
            for (const word of words) {
                translation = word.translations.find(t => t.id === translationId);
                if (translation) {
                    wordForTranslation = word;
                    break;
                }
            }
            
            if (!translation) return;
            
            // Sprawdź czy użytkownik już głosował
            if (userVotes[translationId]) {
                // Usuń głos
                translation.votes--;
                userVotes[translationId] = false;
                
                // Jeśli to głos twórcy, oznacz
                if (currentUser.role === 'creator') {
                    translation.creatorVote = false;
                }
            } else {
                // Dodaj głos
                translation.votes++;
                userVotes[translationId] = true;
                
                // Jeśli głosuje twórca, oznacz
                if (currentUser.role === 'creator') {
                    translation.creatorVote = true;
                }
            }
            
            // Zapisz dane
            saveData();
            
            // Odśwież wyświetlane dane
            loadAcceptedWords();
            
            // Jeśli szczegóły są otwarte, odśwież je też
            if (selectedWordId === wordForTranslation.id) {
                selectWord(selectedWordId);
            }
        }
        
        // Akceptacja słowa przez twórcę
        function acceptWord(wordId) {
            if (currentUser.role !== 'creator') {
                alert('Tylko twórca może akceptować słowa!');
                return;
            }
            
            const wordIndex = words.findIndex(w => w.id === wordId);
            if (wordIndex === -1) return;
            
            words[wordIndex].status = 'accepted';
            saveData();
            
            // Odśwież listy
            loadPendingWords();
            loadRejectedWords();
            loadAllWords();
            loadAcceptedWords();
            
            alert('Słowo zostało zaakceptowane i jest teraz widoczne publicznie!');
        }
        
        // Odrzucenie słowa przez twórcę
        function rejectWord(wordId) {
            if (currentUser.role !== 'creator') {
                alert('Tylko twórca może odrzucać słowa!');
                return;
            }
            
            const wordIndex = words.findIndex(w => w.id === wordId);
            if (wordIndex === -1) return;
            
            words[wordIndex].status = 'rejected';
            saveData();
            
            // Odśwież listy
            loadPendingWords();
            loadRejectedWords();
            loadAllWords();
            loadAcceptedWords();
            
            alert('Słowo zostało odrzucone!');
        }
        
        // Przywrócenie odrzuconego słowa
        function restoreWord(wordId) {
            if (currentUser.role !== 'creator') {
                alert('Tylko twórca może przywracać słowa!');
                return;
            }
            
            const wordIndex = words.findIndex(w => w.id === wordId);
            if (wordIndex === -1) return;
            
            words[wordIndex].status = 'pending';
            saveData();
            
            // Odśwież listy
            loadPendingWords();
            loadRejectedWords();
            loadAllWords();
            
            alert('Słowo zostało przywrócone do oczekujących!');
        }
        
        // Usuwanie słowa przez twórcę
        function deleteWord(wordId) {
            if (currentUser.role !== 'creator') {
                alert('Tylko twórca może usuwać słowa!');
                return;
            }
            
            if (!confirm('Czy na pewno chcesz trwale usunąć to słowo? Operacji nie można cofnąć.')) {
                return;
            }
            
            const wordIndex = words.findIndex(w => w.id === wordId);
            if (wordIndex === -1) return;
            
            words.splice(wordIndex, 1);
            saveData();
            
            // Odśwież listy
            loadPendingWords();
            loadRejectedWords();
            loadAllWords();
            loadAcceptedWords();
            
            // Jeśli usunięto wybrane słowo, ukryj szczegóły
            if (selectedWordId === wordId) {
                document.getElementById('word-details').style.display = 'none';
                selectedWordId = null;
            }
            
            alert('Słowo zostało trwale usunięte z systemu!');
        }
        
        // Przełączanie zakładek
        function switchTab(tabId) {
            // Aktualizuj aktywne zakładki
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                }
            });
            
            // Pokaż odpowiednią zawartość
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.getElementById(`${tabId}-tab`).classList.add('active');
            
            // Odśwież zawartość jeśli potrzeba
            if (tabId === 'rejected') {
                loadRejectedWords();
            } else if (tabId === 'all') {
                loadAllWords();
            }
        }
        
        // Zapisywanie danych do localStorage
        function saveData() {
            localStorage.setItem('translationWords', JSON.stringify(words));
            localStorage.setItem('userVotes', JSON.stringify(userVotes));
            localStorage.setItem('translationUsers', JSON.stringify(users));
        }
        
        // Pobieranie nazwy języka z kodu
        function getLanguageName(code) {
            const languages = {
                'en': 'ANG',
                'pl': 'POL',
                'de': 'DEU',
                'fr': 'FRA',
                'es': 'ESP',
                'it': 'ITA'
            };
            return languages[code] || code.toUpperCase();
        }
        
        // ===================== INICJALIZACJA =====================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Sprawdź stan logowania
            checkLoginStatus();
            
            // ===== OBSŁUGA LOGOWANIA =====
            
            // Przełączanie między loginem a rejestracją
            document.querySelectorAll('.login-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Zmień aktywną zakładkę
                    document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Pokaż odpowiedni formularz
                    document.getElementById('login-form').classList.remove('active');
                    document.getElementById('register-form').classList.remove('active');
                    document.getElementById(`${tabId}-form`).classList.add('active');
                    
                    // Ukryj komunikaty
                    document.getElementById('login-message').className = 'message';
                    document.getElementById('register-message').className = 'message';
                });
            });
            
            // Wybór roli w rejestracji
            document.querySelectorAll('.role-option').forEach(option => {
                option.addEventListener('click', function() {
                    const role = this.getAttribute('data-role');
                    
                    // Zmień aktywną opcję
                    document.querySelectorAll('.role-option').forEach(o => o.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Pokaż/ukryj pole kodu dostępu dla twórcy
                    const creatorNote = document.getElementById('creator-note');
                    const creatorCodeLabel = document.getElementById('creator-code-label');
                    const creatorCodeInput = document.getElementById('creator-code');
                    
                    if (role === 'creator') {
                        creatorNote.style.display = 'block';
                        creatorCodeLabel.style.display = 'block';
                        creatorCodeInput.style.display = 'block';
                        creatorCodeInput.required = true;
                    } else {
                        creatorNote.style.display = 'none';
                        creatorCodeLabel.style.display = 'none';
                        creatorCodeInput.style.display = 'none';
                        creatorCodeInput.required = false;
                    }
                });
            });
            
            // Logowanie
            document.getElementById('login-btn').addEventListener('click', function() {
                const username = document.getElementById('login-username').value.trim();
                const password = document.getElementById('login-password').value.trim();
                
                if (!username || !password) {
                    showMessage('login-message', 'Wypełnij wszystkie pola!', 'error');
                    return;
                }
                
                loginUser(username, password);
            });
            
            // Rejestracja
            document.getElementById('register-btn').addEventListener('click', function() {
                const username = document.getElementById('register-username').value.trim();
                const password = document.getElementById('register-password').value.trim();
                const passwordConfirm = document.getElementById('register-password-confirm').value.trim();
                const role = document.querySelector('.role-option.active').getAttribute('data-role');
                const creatorCode = document.getElementById('creator-code').value;
                
                if (!username || !password || !passwordConfirm) {
                    showMessage('register-message', 'Wypełnij wszystkie pola!', 'error');
                    return;
                }
                
                if (password !== passwordConfirm) {
                    showMessage('register-message', 'Hasła nie są identyczne!', 'error');
                    return;
                }
                
                registerUser(username, password, role, creatorCode);
            });
            
            // Wylogowanie
            document.getElementById('logout-btn').addEventListener('click', logoutUser);
            
            // ===== OBSŁUGA APLIKACJI =====
            
            // Formularz dodawania nowego słowa
            document.getElementById('add-word-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addNewWord();
            });
            
            // Przycisk dodawania tłumaczenia
            document.getElementById('add-translation-btn').addEventListener('click', addTranslation);
            
            // Filtry językowe
            document.getElementById('source-lang').addEventListener('change', function() {
                checkLanguages();
                loadAcceptedWords();
            });
            
            document.getElementById('target-lang').addEventListener('change', function() {
                checkLanguages();
                loadAcceptedWords();
            });
            
            // Taby w panelu moderacji
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // Enter w formularzach logowania
            document.getElementById('login-password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('login-btn').click();
                }
            });
            
            document.getElementById('register-password-confirm').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('register-btn').click();
                }
            });
        });
    </script>
</body>
</html>

